<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Riviera Jomtien - Thai Quota Price List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Sarabun', sans-serif;
        }
        .sort-asc::after {
            content: ' ▲';
            font-size: 0.8em;
        }
        .sort-desc::after {
            content: ' ▼';
            font-size: 0.8em;
        }
        .lang-btn {
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s ease-in-out;
            border: 2px solid transparent;
        }
        .lang-btn.active, .lang-btn:hover {
            opacity: 1;
            transform: scale(1.1);
            border-color: #3b82f6;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #quotationPrintArea, #quotationPrintArea * {
                visibility: visible;
            }
            #quotationPrintArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 md:p-8">
    <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
        <header class="bg-gray-800 text-white p-6 sm:p-8 flex justify-between items-start">
            <div>
                <h1 class="text-3xl sm:text-5xl font-bold" data-lang-key="headerTitle">The Riviera Jomtien</h1>
                <p class="text-gray-300 mt-2">
                     <a href="https://thbho.github.io/RVThPriceList.html" target="_blank" rel="noopener noreferrer" class="text-xl sm:text-2xl text-amber-400 font-bold tracking-wider animate-pulse hover:underline">
                        <span data-lang-key="headerFullPromoTitle">Thai Quota Promotion Price List</span>
                    </a>
                </p>
            </div>
            <div class="flex flex-col items-end">
                 <img src="https://i.postimg.cc/m2xnJNLL/Rivera-topaz-upscale-4x-text-crop-Edited.png" alt="Riviera Jomtien Logo" class="h-12 sm:h-16 rounded-lg mb-4">
                 <div id="languageSwitcher" class="flex space-x-2">
                    <img src="https://flagcdn.com/w40/th.png" alt="Thai Flag" class="lang-btn h-6 rounded-sm active" data-lang="th">
                    <img src="https://flagcdn.com/w40/gb.png" alt="English Flag" class="lang-btn h-6 rounded-sm" data-lang="en">
                    <img src="https://flagcdn.com/w40/ru.png" alt="Russian Flag" class="lang-btn h-6 rounded-sm" data-lang="ru">
                    <img src="https://flagcdn.com/w40/cn.png" alt="Chinese Flag" class="lang-btn h-6 rounded-sm" data-lang="zh">
                </div>
            </div>
        </header>

        <main class="p-6 sm:p-8">
            <!-- Filter Controls -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <input type="text" id="searchInput" data-lang-key-placeholder="searchPlaceholder" placeholder="ค้นหาจากเลขยูนิต..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                <select id="floorFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition bg-white">
                    <option value="" data-lang-key="allFloors">All Floors</option>
                </select>
                <select id="sideFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition bg-white">
                    <option value="" data-lang-key="allSides">All Views</option>
                </select>
                <select id="typeFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition bg-white">
                    <option value="" data-lang-key="allTypes">All Types</option>
                </select>
            </div>

            <!-- Price List Table -->
            <div class="overflow-x-auto border border-gray-200 rounded-lg">
                <table class="min-w-full bg-white">
                    <thead class="bg-gray-700 text-white">
                        <tr>
                           <th class="px-6 py-4 text-left text-sm font-bold uppercase tracking-wider cursor-pointer" data-sort="unitNo" data-lang-key="unitNo">Unit No.</th>
                            <th class="px-6 py-4 text-left text-sm font-bold uppercase tracking-wider cursor-pointer" data-sort="floor" data-lang-key="floor">Floor</th>
                            <th class="px-6 py-4 text-left text-sm font-bold uppercase tracking-wider cursor-pointer" data-sort="side" data-lang-key="side">View</th>
                            <th class="px-6 py-4 text-left text-sm font-bold uppercase tracking-wider cursor-pointer" data-sort="type" data-lang-key="type">Type</th>
                            <th class="px-6 py-4 text-right text-sm font-bold uppercase tracking-wider cursor-pointer" data-sort="sqm" data-lang-key="size">Size (sqm)</th>
                            <th class="px-6 py-4 text-right text-sm font-bold uppercase tracking-wider cursor-pointer" data-sort="sellingPrice" data-lang-key="originalPrice">Original Price</th>
                            <th class="px-6 py-4 text-right text-sm font-bold uppercase tracking-wider cursor-pointer" data-sort="promoPerSqm" data-lang-key="promoPerSqm">Promo Price / sqm</th>
                            <th class="px-6 py-4 text-right text-sm font-bold uppercase tracking-wider cursor-pointer" data-sort="promoPrice" data-lang-key="promoPrice">Promotion Price</th>
                        </tr>
                    </thead>
                    <tbody id="priceTableBody" class="divide-y divide-gray-200">
                        <!-- Rows will be injected by JavaScript -->
                    </tbody>
                </table>
                 <p id="noResults" class="text-center py-8 text-gray-500 hidden" data-lang-key="noResults">No units found matching your criteria.</p>
            </div>
        </main>
        
        <footer class="bg-gray-50 border-t border-gray-200 p-6 sm:p-8">
            <div class="max-w-4xl mx-auto flex flex-col md:flex-row justify-between items-start gap-8">
                <!-- Conditions on the left -->
                <div class="flex-grow">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4" data-lang-key="conditionsTitle">Conditions</h2>
                    <ul id="conditionsList" class="list-disc list-inside space-y-2 text-gray-700">
                        <!-- Conditions will be injected by JavaScript -->
                    </ul>
                </div>
                <!-- QR Code on the right -->
                <div class="flex-shrink-0 w-full md:w-auto text-center mt-6 md:mt-0">
                    <img src="https://i.postimg.cc/Mps1t4jn/RVTh-Price-List-QR.png" alt="QR Code for Thai Quota Price List" class="mx-auto h-32 w-32 rounded-lg shadow-md">
                    <p class="mt-2 text-sm text-gray-600 font-semibold" data-lang-key="interactivePriceList">Interactive Price List</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Quotation Modal -->
    <div id="quotationModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div id="quotationContent" class="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <!-- Modal Header -->
            <div class="p-4 border-b flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl font-bold" data-lang-key="quotationTitle">Quotation</h2>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button>
            </div>
            <!-- Quotation Body -->
            <div id="quotationPrintArea" class="p-8 overflow-y-auto">
                <!-- Quotation Header -->
                <div class="flex justify-between items-start mb-8">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">The Riviera Jomtien</h1>
                        <p class="text-lg font-semibold mt-2" data-lang-key="quotationForUnit">Quotation for Unit:</p>
                        <p id="qUnitNo" class="text-4xl font-bold text-amber-500"></p>
                    </div>
                    <div class="text-right">
                         <img src="https://i.postimg.cc/m2xnJNLL/Rivera-topaz-upscale-4x-text-crop-Edited.png" alt="Logo" class="h-12 mb-2 ml-auto">
                        <p><strong data-lang-key="date">Date:</strong> <span id="qDate"></span></p>
                    </div>
                </div>

                <!-- Unit Details Table -->
                <h3 class="text-lg font-semibold border-b pb-2 mb-4" data-lang-key="unitDetails">Unit Details</h3>
                <table class="w-full mb-8 text-left text-sm">
                    <tbody>
                        <tr class="border-b"><td class="py-2 pr-4 font-semibold" data-lang-key="quota">Quota</td><td id="qQuota" class="py-2 font-bold"></td></tr>
                        <tr class="border-b"><td class="py-2 pr-4 font-semibold" data-lang-key="floor">Floor</td><td id="qFloor" class="py-2"></td></tr>
                        <tr class="border-b"><td class="py-2 pr-4 font-semibold" data-lang-key="side">View</td><td id="qSide" class="py-2"></td></tr>
                        <tr class="border-b"><td class="py-2 pr-4 font-semibold" data-lang-key="type">Type</td><td id="qType" class="py-2"></td></tr>
                        <tr><td class="py-2 pr-4 font-semibold" data-lang-key="size">Size (sqm)</td><td id="qSize" class="py-2"></td></tr>
                    </tbody>
                </table>

                <!-- Price Breakdown Table -->
                <h3 class="text-lg font-semibold border-b pb-2 mb-4" data-lang-key="priceBreakdown">Price Breakdown</h3>
                <table class="w-full mb-8 text-left text-sm">
                    <tbody>
                        <tr class="border-b"><td class="py-2 pr-4" data-lang-key="promoPrice">Promotion Price</td><td id="qPromoPrice" class="py-2 text-right font-semibold"></td></tr>
                        <tr class="border-b"><td class="py-2 pr-4" data-lang-key="sinkingFund">Sinking Fund</td><td id="qSinkingFund" class="py-2 text-right"></td></tr>
                        <tr class="border-b"><td class="py-2 pr-4" data-lang-key="maintenanceFee">Maintenance Fee (1 Year)</td><td id="qMaintenance" class="py-2 text-right"></td></tr>
                        <tr><td class="py-2 pr-4" data-lang-key="transferFee">Transfer Fee (0.01%)</td><td id="qTransfer" class="py-2 text-right"></td></tr>
                    </tbody>
                </table>

                 <!-- Total -->
                <div class="text-right bg-gray-100 p-4 rounded-lg">
                    <p class="text-lg font-semibold" data-lang-key="totalPayable">Total Payable Amount:</p>
                    <p id="qTotal" class="text-3xl font-bold text-blue-600"></p>
                </div>
            </div>
             <!-- Modal Footer -->
            <div class="p-4 border-t flex justify-end space-x-2 bg-gray-50 flex-shrink-0">
                <button id="printQuotationBtn" class="px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" data-lang-key="print">Print</button>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            en: {
                pageTitle: "Riviera Jomtien - Thai Quota Price List",
                headerTitle: "The Riviera Jomtien",
                headerFullPromoTitle: "Thai Quota Promotion Price List",
                searchPlaceholder: "Search by Unit No...",
                allFloors: "All Floors",
                allSides: "All Views",
                allTypes: "All Types",
                unitNo: "Unit No.",
                floor: "Floor",
                side: "View",
                type: "Type",
                size: "Size (sqm)",
                originalPrice: "Original Price",
                promoPerSqm: "Promo Price / sqm",
                promoPrice: "Promotion Price",
                noResults: "No units found matching your criteria.",
                interactivePriceList: "Interactive Price List",
                conditionsTitle: "Conditions",
                conditions: [
                    "Furniture package from project according to list mention",
                    "All units make contract with project",
                    "This Price is not included*Sinking fund 500/sqm",
                    "Maintenance fee 50/sqm. Per month (Advance one year)",
                    "Transfer fee 0.01% or according to the announcement from landoffice.",
                    "*Included commission for Agent 7%",
                    "Effective until December 31, 2025",
                    "Approve by ___________________________"
                ],
                dataValues: { "Sea": "Sea", "City": "City", "One bed": "One-Bed" },
                // Quotation translations
                quotationTitle: "Quotation",
                quotationForUnit: "Quotation for Unit:",
                date: "Date",
                unitDetails: "Unit Details",
                priceBreakdown: "Price Breakdown",
                sinkingFund: "Sinking Fund (500 THB/sqm)",
                maintenanceFee: "Maintenance Fee (1 Year)",
                transferFee: "Transfer Fee (0.01%)",
                totalPayable: "Total Payable Amount",
                print: "Print",
                quota: "Quota",
                quotaType: "Thai Quota"
            },
            th: {
                pageTitle: "Riviera Jomtien - รายการราคาโปรโมชั่นโควต้าไทย",
                headerTitle: "The Riviera Jomtien",
                headerFullPromoTitle: "Thai Quota Promotion Price List",
                searchPlaceholder: "ค้นหาจากเลขยูนิต...",
                allFloors: "ทุกชั้น",
                allSides: "ทุกวิว",
                allTypes: "ทุกประเภท",
                unitNo: "เลขยูนิต",
                floor: "ชั้น",
                side: "วิว",
                type: "ประเภท",
                size: "ขนาด (ตร.ม.)",
                originalPrice: "ราคาปกติ",
                promoPerSqm: "ราคาโปรฯ/ตร.ม.",
                promoPrice: "ราคาโปรโมชั่น",
                noResults: "ไม่พบยูนิตที่ตรงกับเงื่อนไขของคุณ",
                interactivePriceList: "รายการราคาแบบอินเทอร์แอคทีฟ",
                conditionsTitle: "เงื่อนไขและข้อกำหนด",
                conditions: [
                    "พร้อมเฟอร์นิเจอร์แพ็คเกจจากโครงการตามรายการที่ระบุ",
                    "ทุกยูนิตทำสัญญากับทางโครงการ",
                    "ราคานี้ไม่รวม*ค่ากองทุน 500/ตร.ม.",
                    "ค่าส่วนกลาง 50/ตร.ม. ต่อเดือน (ชำระล่วงหน้า 1 ปี)",
                    "ค่าโอน 0.01% หรือตามประกาศจากกรมที่ดิน",
                    "*ราคารวมค่าคอมมิชชั่นสำหรับเอเจนต์ 7%",
                    "มีผลถึงวันที่ 31 ธันวาคม 2568",
                    "อนุมัติโดย ___________________________"
                ],
                dataValues: { "Sea": "วิวทะเล", "City": "วิวเมือง", "One bed": "1 ห้องนอน" },
                // Quotation translations
                quotationTitle: "ใบเสนอราคา",
                quotationForUnit: "ใบเสนอราคาสำหรับยูนิต:",
                date: "วันที่",
                unitDetails: "รายละเอียดยูนิต",
                priceBreakdown: "รายการค่าใช้จ่าย",
                sinkingFund: "ค่ากองทุน (500 บาท/ตร.ม.)",
                maintenanceFee: "ค่าส่วนกลาง (1 ปี)",
                transferFee: "ค่าธรรมเนียมการโอน (0.01%)",
                totalPayable: "ยอดรวมที่ต้องชำระ",
                print: "พิมพ์",
                quota: "โควต้า",
                quotaType: "โควต้าไทย"
            },
            ru: {
                pageTitle: "Riviera Jomtien - Прайс-лист для тайской квоты",
                headerTitle: "The Riviera Jomtien",
                headerFullPromoTitle: "Акция для тайской квоты - Прайс-лист",
                searchPlaceholder: "Поиск по номеру юнита...",
                allFloors: "Все этажи",
                allSides: "Все виды",
                allTypes: "Все типы",
                unitNo: "№ юнита",
                floor: "Этаж",
                side: "Вид",
                type: "Тип",
                size: "Размер (кв.м)",
                originalPrice: "Первоначальная цена",
                promoPerSqm: "Цена по акции / кв.м",
                promoPrice: "Цена по акции",
                noResults: "Не найдено юнитов, соответствующих вашим критериям.",
                interactivePriceList: "Интерактивный прайс-лист",
                conditionsTitle: "Условия и положения",
                conditions: [
                    "Пакет мебели от проекта согласно указанному списку",
                    "Все юниты заключают контракт с проектом",
                    "В эту цену не включен* амортизационный фонд 500/кв.м.",
                    "Плата за обслуживание 50/кв.м. в месяц (предоплата за один год)",
                    "Комиссия за перевод 0,01% или согласно объявлению земельного управления.",
                    "*Включая комиссию для Агента 7%",
                    "Действительно до 31 декабря 2025 г.",
                    "Утверждено ___________________________"
                ],
                dataValues: { "Sea": "Вид на море", "City": "Вид на город", "One bed": "1 спальня" },
                 // Quotation translations
                quotationTitle: "Предложение",
                quotationForUnit: "Предложение для юнита:",
                date: "Дата",
                unitDetails: "Детали юнита",
                priceBreakdown: "Разбивка цены",
                sinkingFund: "Амортизационный фонд (500 THB/кв.м)",
                maintenanceFee: "Плата за обслуживание (1 год)",
                transferFee: "Комиссия за перевод (0,01%)",
                totalPayable: "Общая сумма к оплате",
                print: "Печать",
                quota: "Квота",
                quotaType: "Тайская квота"
            },
            zh: {
                pageTitle: "里维埃拉中天 - 泰国配额价格表",
                headerTitle: "The Riviera Jomtien",
                headerFullPromoTitle: "泰国配额促销价格表",
                searchPlaceholder: "按单元号搜索...",
                allFloors: "所有楼层",
                allSides: "所有景观",
                allTypes: "所有类型",
                unitNo: "单元号",
                floor: "楼层",
                side: "景观",
                type: "类型",
                size: "面积 (平方米)",
                originalPrice: "原价",
                promoPerSqm: "促销价/平方米",
                promoPrice: "促销价",
                noResults: "未找到符合您条件的单元。",
                interactivePriceList: "互动价格表",
                conditionsTitle: "条款和条件",
                conditions: [
                    "根据项目清单提供家具套餐",
                    "所有单位均与项目签订合同",
                    "此价格不包括*维修基金 500/平方米",
                    "物业费 50/平方米/月（预付一年）",
                    "过户费 0.01% 或根据土地局的公告。",
                    "*包括代理商佣金 7%",
                    "有效期至 2025 年 12 月 31 日",
                    "批准人 ___________________________"
                ],
                dataValues: { "Sea": "海景", "City": "城景", "One bed": "一卧室" },
                // Quotation translations
                quotationTitle: "报价单",
                quotationForUnit: "单元报价:",
                date: "日期",
                unitDetails: "单元详情",
                priceBreakdown: "价格明细",
                sinkingFund: "维修基金 (500 泰铢/平方米)",
                maintenanceFee: "物业费 (1年)",
                transferFee: "过户费 (0.01%)",
                totalPayable: "应付总额",
                print: "打印",
                quota: "配额",
                quotaType: "泰国配额"
            }
        };

        let currentLang = 'th';

        const csvData = `No.,Floor,Side,Type,Unit No.,SQ.M,Selling Price,Promotion/sqm,Selling-Promotion
1,8,Sea,One bed,8A03,32.66,4311120,84476,2759000
2,8,Sea,One bed,8A04,47.38,6254160,84213,3959000
3,8,Sea,One bed,8A05,46.92,6193440,84378,3959000
4,8,Sea,One bed,8A06,31.86,4205520,84714,2699000
5,9,Sea,One bed,9A02,32.64,4341120,87592,2859000
6,9,Sea,One bed,9A04,47.38,6301540,84403,3999000
7,9,Sea,One bed,9A06,31.86,4237380,87853,2759000
8,11,City,One bed,11E06,34.28,3805080,87485,2999000
9,12,City,One bed,12E11,34.45,3858400,87054,2999000
10,12,City,One bed,12E12,34.45,3858400,87054,2999000
11,25,Sea,One bed,25A05,46.92,6568800,92903,4359000`;
        
        const unitData = csvData.split('\n').slice(1).map(row => {
            const columns = row.split(',');
            return {
                no: parseInt(columns[0], 10),
                floor: columns[1],
                side: columns[2],
                type: columns[3],
                unitNo: columns[4],
                sqm: parseFloat(columns[5]),
                sellingPrice: parseInt(columns[6], 10),
                promoPerSqm: parseInt(columns[7], 10),
                promoPrice: parseInt(columns[8], 10),
            };
        });

        const searchInput = document.getElementById('searchInput');
        const floorFilter = document.getElementById('floorFilter');
        const sideFilter = document.getElementById('sideFilter');
        const typeFilter = document.getElementById('typeFilter');
        const tableBody = document.getElementById('priceTableBody');
        const noResults = document.getElementById('noResults');
        const tableHeaders = document.querySelectorAll('th[data-sort]');
        const languageSwitcher = document.getElementById('languageSwitcher');
        const conditionsList = document.getElementById('conditionsList');
        // Modal Elements
        const quotationModal = document.getElementById('quotationModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const printQuotationBtn = document.getElementById('printQuotationBtn');

        let currentSort = { key: 'no', direction: 'asc' };
        const formatCurrency = (amount) => `฿${new Intl.NumberFormat('en-US').format(amount)}`;

        function changeLanguage(lang) {
            currentLang = lang;
            const langData = translations[lang];
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                if(langData[key]) {
                   el.textContent = langData[key];
                }
            });
            document.querySelectorAll('[data-lang-key-placeholder]').forEach(el => {
                const key = el.getAttribute('data-lang-key-placeholder');
                el.placeholder = langData[key];
            });
            document.getElementById('pageTitle').textContent = langData.pageTitle;
            conditionsList.innerHTML = '';
            langData.conditions.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                conditionsList.appendChild(li);
            });
            languageSwitcher.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            renderTable();
        }

        function populateFilters() {
            const floors = [...new Set(unitData.map(item => item.floor))].sort((a, b) => a.localeCompare(b, undefined, {numeric: true}));
            const sides = [...new Set(unitData.map(item => item.side))];
            const types = [...new Set(unitData.map(item => item.type))];
            const selectedFloor = floorFilter.value;
            const selectedSide = sideFilter.value;
            const selectedType = typeFilter.value;
            floorFilter.length = 1;
            sideFilter.length = 1;
            typeFilter.length = 1;
            floors.forEach(floor => {
                const option = document.createElement('option');
                option.value = floor;
                option.textContent = `Floor ${floor}`;
                floorFilter.appendChild(option);
            });
            sides.forEach(side => {
                const option = document.createElement('option');
                option.value = side;
                option.textContent = translations[currentLang].dataValues[side] || side;
                sideFilter.appendChild(option);
            });
            types.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = translations[currentLang].dataValues[type] || type;
                typeFilter.appendChild(option);
            });
            floorFilter.value = selectedFloor;
            sideFilter.value = selectedSide;
            typeFilter.value = selectedType;
        }

        function renderTable() {
            populateFilters();
            const searchTerm = searchInput.value.toLowerCase();
            const selectedFloor = floorFilter.value;
            const selectedSide = sideFilter.value;
            const selectedType = typeFilter.value;
            let filteredData = unitData.filter(item => {
                const matchesSearch = item.unitNo.toLowerCase().includes(searchTerm);
                const matchesFloor = !selectedFloor || item.floor.toString() === selectedFloor;
                const matchesSide = !selectedSide || item.side === selectedSide;
                const matchesType = !selectedType || item.type === selectedType;
                return matchesSearch && matchesFloor && matchesSide && matchesType;
            });
            filteredData.sort((a, b) => {
                let valA = a[currentSort.key];
                let valB = b[currentSort.key];
                if(currentSort.key === 'floor') {
                    const numA = parseInt(valA, 10);
                    const numB = parseInt(valB, 10);
                    if (numA < numB) return currentSort.direction === 'asc' ? -1 : 1;
                    if (numA > numB) return currentSort.direction === 'asc' ? 1 : -1;
                    return 0;
                }
                if (typeof valA === 'string') { valA = valA.toLowerCase(); valB = valB.toLowerCase(); }
                if (valA < valB) return currentSort.direction === 'asc' ? -1 : 1;
                if (valA > valB) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
            tableBody.innerHTML = '';
            noResults.style.display = filteredData.length === 0 ? 'block' : 'none';
            filteredData.forEach((item, index) => {
                const row = document.createElement('tr');
                const bgColorClass = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                row.className = `${bgColorClass} hover:bg-amber-100 transition-colors`;
                const langData = translations[currentLang];
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-lg font-bold text-amber-500">${item.unitNo}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.floor}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${langData.dataValues[item.side] || item.side}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${langData.dataValues[item.type] || item.type}</td>
                    <td class="px-6 py-4 whitespace-nowrap font-bold text-gray-600 text-right">${item.sqm.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400 text-right line-through">${formatCurrency(item.sellingPrice)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${formatCurrency(item.promoPerSqm)}</td>
                    <td class="px-6 py-4 whitespace-nowrap font-bold text-blue-600 text-right cursor-pointer hover:underline promo-price-cell" data-unit-no="${item.unitNo}">${formatCurrency(item.promoPrice)}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function updateSortIndicators() {
            tableHeaders.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
                if (header.dataset.sort === currentSort.key) {
                    header.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            });
        }
        
        function showQuotation(unit) {
            const langData = translations[currentLang];
            // Calculations
            const sinkingFund = unit.sqm * 500;
            const maintenance = unit.sqm * 50 * 12;
            const transferFee = unit.promoPrice * 0.0001; // 0.01%
            const total = unit.promoPrice + sinkingFund + maintenance + transferFee;

            // Populate Modal
            document.getElementById('qUnitNo').textContent = unit.unitNo;
            document.getElementById('qDate').textContent = new Date().toLocaleDateString(currentLang === 'th' ? 'th-TH' : 'en-CA');
            document.getElementById('qQuota').textContent = langData.quotaType;
            document.getElementById('qFloor').textContent = unit.floor;
            document.getElementById('qSide').textContent = langData.dataValues[unit.side] || unit.side;
            document.getElementById('qType').textContent = langData.dataValues[unit.type] || unit.type;
            document.getElementById('qSize').textContent = `${unit.sqm.toFixed(2)} sqm`;
            document.getElementById('qPromoPrice').textContent = formatCurrency(unit.promoPrice);
            document.getElementById('qSinkingFund').textContent = formatCurrency(sinkingFund);
            document.getElementById('qMaintenance').textContent = formatCurrency(maintenance);
            document.getElementById('qTransfer').textContent = formatCurrency(transferFee);
            document.getElementById('qTotal').textContent = formatCurrency(total);
            
            // Translate static text in modal
            quotationModal.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                if (langData[key]) {
                    el.textContent = langData[key];
                }
            });
            
            quotationModal.classList.remove('hidden');
            quotationModal.classList.add('flex');
        }

        function hideQuotation() {
            quotationModal.classList.add('hidden');
            quotationModal.classList.remove('flex');
        }

        function printQuotation() {
            window.print();
        }

        // --- EVENT LISTENERS ---
        [searchInput, floorFilter, sideFilter, typeFilter].forEach(el => el.addEventListener('change', renderTable));
        
        tableHeaders.forEach(header => {
            header.addEventListener('click', () => {
                const sortKey = header.dataset.sort;
                currentSort.direction = (currentSort.key === sortKey && currentSort.direction === 'asc') ? 'desc' : 'asc';
                currentSort.key = sortKey;
                updateSortIndicators();
                renderTable();
            });
        });

        languageSwitcher.addEventListener('click', (e) => {
            if (e.target.matches('.lang-btn')) {
                const lang = e.target.dataset.lang;
                if (lang) changeLanguage(lang);
            }
        });
        
        tableBody.addEventListener('click', (e) => {
            const cell = e.target.closest('.promo-price-cell');
            if (cell) {
                const unitNo = cell.dataset.unitNo;
                const unit = unitData.find(u => u.unitNo === unitNo);
                if (unit) showQuotation(unit);
            }
        });

        closeModalBtn.addEventListener('click', hideQuotation);
        printQuotationBtn.addEventListener('click', printQuotation);

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            updateSortIndicators();
            changeLanguage(currentLang);
        });
    </script>
</body>
</html>

