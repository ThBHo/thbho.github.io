<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ใบเสนอราคาสำหรับคุณ Nantapak - WIDEROOMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans', 'Sarabun', sans-serif;
        }
        .quotation-card {
            transition: all 0.3s ease-in-out;
        }
        .quotation-card.checked {
            border-color: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
            transform: translateY(-2px);
        }
        .tab-button.active {
            border-color: #2563eb;
            background-color: #eff6ff;
            color: #1d4ed8;
            font-weight: 700;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .lang-button {
            transition: background-color 0.2s;
        }
        .lang-button.active {
            background-color: #2563eb;
            color: white;
            font-weight: 700;
        }
        /* Modal and Loader */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            max-width: 90%;
            width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: transform 0.3s;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-8 max-w-5xl">
        
        <!-- Language Switcher -->
        <div class="flex justify-end mb-4">
            <div class="flex border border-gray-300 rounded-lg overflow-hidden">
                <button class="lang-button px-3 py-1 text-sm" data-lang-btn="th" onclick="changeLanguage('th')">TH</button>
                <button class="lang-button px-3 py-1 text-sm border-l" data-lang-btn="en" onclick="changeLanguage('en')">EN</button>
                <button class="lang-button px-3 py-1 text-sm border-l" data-lang-btn="ru" onclick="changeLanguage('ru')">RU</button>
                <button class="lang-button px-3 py-1 text-sm border-l" data-lang-btn="zh" onclick="changeLanguage('zh')">CN</button>
            </div>
        </div>

        <!-- Header -->
        <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 pb-4 border-b">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">WIDEROOMS</h1>
                <p class="text-gray-500" data-lang="tagline">Personalized Your Home</p>
            </div>
            <div class="text-left sm:text-right mt-4 sm:mt-0">
                <h2 class="text-xl font-bold text-gray-900" data-lang="quotation_title">ใบเสนอราคา</h2>
                <p class="text-sm text-gray-600"><span data-lang="for">สำหรับ</span>: คุณ Nantapak Kraironnaphoom</p>
                <p class="text-sm text-gray-600"><span data-lang="date">วันที่</span>: 11 สิงหาคม 2568</p>
            </div>
        </header>

        <!-- Introduction -->
        <div class="mb-10 p-6 bg-white rounded-lg shadow-sm">
            <h3 class="text-xl font-semibold mb-3 text-gray-900" data-lang="greeting">เรียน คุณ Nantapak,</h3>
            <p class="text-gray-700 leading-relaxed" data-lang="intro_text">
                ตามที่เราได้พูดคุยกันเรื่องการออกแบบตกแต่งคอนโดขนาด 35 ตร.ม. ของคุณ ทาง WIDEROOMS ได้นำข้อมูลความต้องการและบุคลิกภาพแบบ INTP ของคุณ มาสร้างสรรค์เป็นใบเสนอราคาฉบับโต้ตอบได้นี้ เพื่อให้คุณสามารถเลือกปรับรายการต่างๆ และเห็นภาพรวมของงบประมาณได้ชัดเจนยิ่งขึ้นครับ
            </p>
        </div>

        <!-- Design Concepts Section -->
        <div class="mb-10">
            <h3 class="text-2xl font-bold text-center mb-6 text-gray-900" data-lang="concepts_title">แนวคิดการออกแบบสำหรับคุณ</h3>
            <div class="flex flex-wrap justify-center border-b mb-6">
                <button id="tab-concept1" class="tab-button active py-2 px-4 sm:px-6 border-b-2" onclick="showTab('concept1')">Coastal Futurist</button>
                <button id="tab-concept2" class="tab-button py-2 px-4 sm:px-6 border-b-2" onclick="showTab('concept2')">Monochrome Oasis</button>
                <button id="tab-concept3" class="tab-button py-2 px-4 sm:px-6 border-b-2" onclick="showTab('concept3')">Intelligent Beach House</button>
            </div>
            <div id="concept1" class="tab-content active">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1617806118233-18e1de247200?q=80&w=2070&auto=format&fit=crop" alt="ภาพแนวคิด Coastal Futurist" class="w-full h-64 object-cover">
                    <div class="p-6">
                        <h4 class="font-bold text-lg mb-2">The "Coastal Futurist" Retreat</h4>
                        <p class="text-gray-600" data-lang="concept1_desc">ผสมผสานความสงบของสไตล์ Coastal Zen เข้ากับเส้นสายที่เฉียบคมและนวัตกรรมของดีไซน์ Futuristic เน้นบรรยากาศที่โปร่ง โล่ง สบายตา แต่แฝงไปด้วยรายละเอียดที่น่าสนใจและชาญฉลาด</p>
                        <button class="mt-4 bg-blue-100 text-blue-800 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-blue-200 transition" onclick="openAiAssistant('concept1')" data-lang="ask_ai_btn">สอบถาม AI ✨</button>
                    </div>
                </div>
            </div>
            <div id="concept2" class="tab-content">
                 <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1616486338812-3dadae4b4ace?q=80&w=1932&auto=format&fit=crop" alt="ภาพแนวคิด Monochrome Oasis" class="w-full h-64 object-cover">
                    <div class="p-6">
                        <h4 class="font-bold text-lg mb-2">The "Monochrome Oasis"</h4>
                        <p class="text-gray-600" data-lang="concept2_desc">ดึงความสง่างามของโทนสีขาว-เทา-ดำมาใช้เป็นหัวใจหลัก สร้างพื้นที่ที่ดูสะอาด มีความเป็นระเบียบ แต่ยังคงความอบอุ่นและน่าอยู่ เหมาะสำหรับ INTP ที่ชอบสภาพแวดล้อมที่เป็นระเบียบ</p>
                        <button class="mt-4 bg-blue-100 text-blue-800 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-blue-200 transition" onclick="openAiAssistant('concept2')" data-lang="ask_ai_btn">สอบถาม AI ✨</button>
                    </div>
                </div>
            </div>
            <div id="concept3" class="tab-content">
                 <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <img src="https://i.postimg.cc/TPSnrTp3/Gemini-Generated-Image-xvrq6sxvrq6sxvrq-1.png" alt="ภาพแนวคิด Intelligent Beach House" class="w-full h-64 object-cover">
                    <div class="p-6">
                        <h4 class="font-bold text-lg mb-2">The "Intelligent Beach House"</h4>
                        <p class="text-gray-600" data-lang="concept3_desc">ตีความ "Futuristic Beach House" ในแบบฉบับ INTP คือการผสมผสานเทคโนโลยีเข้ากับบรรยากาศสบายๆ ริมทะเลอย่างลงตัว เน้นฟังก์ชันการใช้งานที่ชาญฉลาดและปรับเปลี่ยนได้</p>
                        <button class="mt-4 bg-blue-100 text-blue-800 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-blue-200 transition" onclick="openAiAssistant('concept3')" data-lang="ask_ai_btn">สอบถาม AI ✨</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Interactive Quotation -->
        <div>
            <h3 class="text-2xl font-bold text-center mb-2 text-gray-900" data-lang="selection_title">เลือกรายการตกแต่งและบริการ</h3>
            <p class="text-center text-gray-500 mb-6" data-lang="selection_subtitle">กรุณาเลือกรายการที่คุณสนใจเพื่อคำนวณราคารวม</p>
            
            <div id="quotation-items" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Items will be injected here by JavaScript -->
            </div>
        </div>

        <!-- Total Cost -->
        <div class="mt-10 pt-6 border-t-2 sticky bottom-0 bg-white/80 backdrop-blur-sm shadow-t-xl rounded-t-lg p-4">
            <div class="flex justify-between items-center max-w-4xl mx-auto">
                <span class="text-xl font-semibold text-gray-800" data-lang="total_label">ราคารวมโดยประมาณ:</span>
                <span id="total-cost" class="text-3xl font-bold text-blue-600">0 THB</span>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 pt-6 border-t">
            <p class="font-semibold">WIDEROOMS</p>
            <p class="text-sm text-gray-600" data-lang="contact_info">Email: widerooms@gmail.com | Phone: +66 86 909 4356</p>
            <p class="text-xs text-gray-500 mt-2" data-lang="disclaimer">ราคานี้เป็นการประมาณการเบื้องต้นและอาจเปลี่ยนแปลงได้ตามวัสดุที่เลือก</p>
        </footer>
    </div>

    <!-- AI Modal -->
    <div id="ai-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-title" class="text-2xl font-bold mb-4"></h3>
            <div id="modal-body"></div>
            <div class="flex justify-end mt-6">
                <button class="bg-gray-200 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-300" onclick="closeAiModal()" data-lang="close_btn">ปิด</button>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="modal-overlay">
        <div class="loader"></div>
    </div>


    <script>
        // --- TRANSLATIONS & DATA ---
        const translations = {
            th: {
                tagline: "Personalized Your Home",
                quotation_title: "ใบเสนอราคา",
                for: "สำหรับ",
                date: "วันที่",
                greeting: "เรียน คุณ Nantapak,",
                intro_text: "ตามที่เราได้พูดคุยกันเรื่องการออกแบบตกแต่งคอนโดขนาด 35 ตร.ม. ของคุณ ทาง WIDEROOMS ได้นำข้อมูลความต้องการและบุคลิกภาพแบบ INTP ของคุณ มาสร้างสรรค์เป็นใบเสนอราคาฉบับโต้ตอบได้นี้ เพื่อให้คุณสามารถเลือกปรับรายการต่างๆ และเห็นภาพรวมของงบประมาณได้ชัดเจนยิ่งขึ้นครับ",
                concepts_title: "แนวคิดการออกแบบสำหรับคุณ",
                concept1_desc: "ผสมผสานความสงบของสไตล์ Coastal Zen เข้ากับเส้นสายที่เฉียบคมและนวัตกรรมของดีไซน์ Futuristic เน้นบรรยากาศที่โปร่ง โล่ง สบายตา แต่แฝงไปด้วยรายละเอียดที่น่าสนใจและชาญฉลาด",
                concept2_desc: "ดึงความสง่างามของโทนสีขาว-เทา-ดำมาใช้เป็นหัวใจหลัก สร้างพื้นที่ที่ดูสะอาด มีความเป็นระเบียบ แต่ยังคงความอบอุ่นและน่าอยู่ เหมาะสำหรับ INTP ที่ชอบสภาพแวดล้อมที่เป็นระเบียบ",
                concept3_desc: "ตีความ \"Futuristic Beach House\" ในแบบฉบับ INTP คือการผสมผสานเทคโนโลยีเข้ากับบรรยากาศสบายๆ ริมทะเลอย่างลงตัว เน้นฟังก์ชันการใช้งานที่ชาญฉลาดและปรับเปลี่ยนได้",
                selection_title: "เลือกรายการตกแต่งและบริการ",
                selection_subtitle: "กรุณาเลือกรายการที่คุณสนใจเพื่อคำนวณราคารวม",
                total_label: "ราคารวมโดยประมาณ:",
                contact_info: "อีเมล: widerooms@gmail.com | โทร: +66 86 909 4356",
                disclaimer: "ราคานี้เป็นการประมาณการเบื้องต้นและอาจเปลี่ยนแปลงได้ตามวัสดุที่เลือก",
                ask_ai_btn: "สอบถาม AI ✨",
                visualize_ai_btn: "สร้างภาพในใจด้วย AI ✨",
                close_btn: "ปิด",
                ai_assistant_title: "AI ช่วยออกแบบ",
                ai_visualize_title: "ภาพในใจจาก AI",
                ai_assistant_prompt: "คุณสามารถถามคำถาม หรือขอให้ปรับแก้แนวคิดนี้ได้เลยครับ เช่น 'ช่วยเพิ่มพื้นที่เก็บของแบบซ่อนในดีไซน์นี้หน่อย' หรือ 'มีสีอื่นแนะนำสำหรับห้องนี้ไหม?'",
                submit_query_btn: "ส่งคำถาม",
                loading_text: "กำลังสร้างสรรค์ไอเดีย...",
                error_text: "เกิดข้อผิดพลาดในการติดต่อ AI กรุณาลองใหม่อีกครั้ง"
            },
            en: {
                tagline: "Personalized Your Home",
                quotation_title: "Quotation",
                for: "For",
                date: "Date",
                greeting: "Dear Khun Nantapak,",
                intro_text: "Following our discussion about designing your 35 sqm condo, WIDEROOMS has created this interactive quotation based on your needs and INTP personality. This allows you to select and adjust items to see a clear overview of the budget.",
                concepts_title: "Design Concepts For You",
                concept1_desc: "Combines the tranquility of Coastal Zen with the sharp lines and innovation of Futuristic design, focusing on a bright, airy atmosphere with smart, interesting details.",
                concept2_desc: "Utilizes the elegance of monochrome tones as its core, creating a clean, orderly space that remains warm and inviting, perfect for an INTP who prefers an organized environment.",
                concept3_desc: "An INTP's interpretation of a \"Futuristic Beach House\": seamlessly blending technology with a relaxed seaside vibe, emphasizing smart and adaptable functionality.",
                selection_title: "Select Decoration & Services",
                selection_subtitle: "Please select the items you are interested in to calculate the total price.",
                total_label: "Estimated Total Cost:",
                contact_info: "Email: widerooms@gmail.com | Phone: +66 86 909 4356",
                disclaimer: "This is a preliminary estimate and may change based on selected materials.",
                ask_ai_btn: "Ask AI ✨",
                visualize_ai_btn: "Visualize with AI ✨",
                close_btn: "Close",
                ai_assistant_title: "AI Design Assistant",
                ai_visualize_title: "AI Visualization",
                ai_assistant_prompt: "You can ask questions or request modifications to this concept. For example, 'Can you add more hidden storage to this design?' or 'What other colors would you recommend for this room?'",
                submit_query_btn: "Submit Query",
                loading_text: "Generating ideas...",
                error_text: "An error occurred while contacting the AI. Please try again."
            },
            ru: {
                tagline: "Персонализируйте свой дом",
                quotation_title: "Ценовое предложение",
                for: "Для",
                date: "Дата",
                greeting: "Уважаемый(ая) Кхун Нантапак,",
                intro_text: "После нашего обсуждения дизайна вашей квартиры площадью 35 кв.м, WIDEROOMS подготовил это интерактивное ценовое предложение, основанное на ваших потребностях и личности типа INTP. Это позволит вам выбирать и корректировать пункты, чтобы получить ясное представление о бюджете.",
                concepts_title: "Концепции дизайна для вас",
                concept1_desc: "Сочетает спокойствие стиля Coastal Zen с четкими линиями и инновациями футуристического дизайна, создавая светлую, воздушную атмосферу с умными и интересными деталями.",
                concept2_desc: "Использует элегантность монохромных тонов в качестве основы, создавая чистое, упорядоченное пространство, которое остается теплым и уютным, идеально подходящим для INTP, предпочитающего организованную среду.",
                concept3_desc: "Интерпретация \"Футуристического пляжного домика\" для INTP: гармоничное сочетание технологий с расслабленной приморской атмосферой, с акцентом на умную и адаптируемую функциональность.",
                selection_title: "Выберите декор и услуги",
                selection_subtitle: "Пожалуйста, выберите интересующие вас пункты для расчета общей стоимости.",
                total_label: "Примерная общая стоимость:",
                contact_info: "Эл. почта: widerooms@gmail.com | Тел: +66 86 909 4356",
                disclaimer: "Это предварительная оценка, которая может измениться в зависимости от выбранных материалов.",
                ask_ai_btn: "Спросить ИИ ✨",
                visualize_ai_btn: "Визуализировать с ИИ ✨",
                close_btn: "Закрыть",
                ai_assistant_title: "ИИ-ассистент по дизайну",
                ai_visualize_title: "Визуализация от ИИ",
                ai_assistant_prompt: "Вы можете задавать вопросы или запрашивать изменения в этой концепции. Например, 'Можете ли вы добавить больше скрытого хранения в этот дизайн?' или 'Какие другие цвета вы бы порекомендовали для этой комнаты?'",
                submit_query_btn: "Отправить запрос",
                loading_text: "Генерация идей...",
                error_text: "Произошла ошибка при обращении к ИИ. Пожалуйста, попробуйте еще раз."
            },
            zh: {
                tagline: "个性化您的家",
                quotation_title: "报价单",
                for: "致",
                date: "日期",
                greeting: "尊敬的 Nantapak 先生/女士,",
                intro_text: "根据我们关于您 35 平方米公寓设计的讨论，WIDEROOMS 已根据您的需求和 INTP 人格类型创建了此交互式报价单。这使您可以选择和调整项目，以清晰地了解预算概况。",
                concepts_title: "为您量身打造的设计理念",
                concept1_desc: "将沿海禅意的宁静与未来主义设计的鲜明线条和创新相结合，营造出明亮、通风的氛围，并融入智能、有趣的细节。",
                concept2_desc: "以单色调的优雅为核心，创造一个干净、有序的空间，同时保持温暖和温馨，非常适合喜欢有组织环境的 INTP。",
                concept3_desc: "INTP 对“未来派海滨别墅”的诠释：将技术与轻松的海滨氛围无缝融合，强调智能和适应性强的​​功能。",
                selection_title: "选择装修和服务项目",
                selection_subtitle: "请选择您感兴趣的项目以计算总价。",
                total_label: "预计总费用:",
                contact_info: "电子邮件: widerooms@gmail.com | 电话: +66 86 909 4356",
                disclaimer: "此为初步估算，最终价格可能因所选材料而异。",
                ask_ai_btn: "询问 AI ✨",
                visualize_ai_btn: "AI 视觉化 ✨",
                close_btn: "关闭",
                ai_assistant_title: "AI 设计助手",
                ai_visualize_title: "AI 视觉化呈现",
                ai_assistant_prompt: "您可以就此概念提出问题或要求修改。例如，'可以在这个设计中增加更多的隐藏储物空间吗？' 或 '您会推荐什么其他颜色用于这个房间？'",
                submit_query_btn: "提交问题",
                loading_text: "正在生成想法...",
                error_text: "连接 AI 时发生错误。请再试一次。"
            }
        };

        const quotationData = [
            { id: 'design-fee', cost: 30000, checked: true, name: { th: 'ค่าบริการออกแบบ', en: 'Design Fee', ru: 'Стоимость дизайна', zh: '设计费' }, description: { th: 'ให้คำปรึกษา, ออกแบบ 3D, จัดทำแบบ และควบคุมการตกแต่ง', en: 'Consultation, 3D design, blueprinting, and project supervision', ru: 'Консультации, 3D-дизайн, чертежи и авторский надзор', zh: '咨询、3D设计、施工图和项目监督' } },
            { id: 'bedroom-furniture', cost: 55000, checked: true, name: { th: 'เฟอร์นิเจอร์ห้องนอน', en: 'Bedroom Furniture', ru: 'Мебель для спальни', zh: '卧室家具' }, description: { th: 'เตียงนอนพร้อมที่เก็บของ, ตู้เสื้อผ้า Built-in, โต๊ะข้างเตียง', en: 'Bed with storage, built-in wardrobe, bedside tables', ru: 'Кровать с ящиками, встроенный шкаф, прикроватные тумбы', zh: '带储物功能的床、内置衣柜、床头柜' } },
            { id: 'livingroom-furniture', cost: 60000, checked: true, name: { th: 'เฟอร์นิเจอร์ห้องนั่งเล่น', en: 'Living Room Furniture', ru: 'Мебель для гостиной', zh: '客厅家具' }, description: { th: 'โซฟา, โต๊ะกลาง, ชั้นวางทีวี/ชั้นวางของ', en: 'Sofa, coffee table, TV stand/shelving unit', ru: 'Диван, журнальный столик, тумба под ТВ/стеллаж', zh: '沙发、茶几、电视柜/置物架' } },
            { id: 'decor-art', cost: 15000, checked: true, name: { th: 'ของตกแต่งและศิลปะ', en: 'Decor & Artwork', ru: 'Декор и предметы искусства', zh: '装饰与艺术品' }, description: { th: 'ของตกแต่งสไตล์มินิมอล, ภาพถ่ายศิลปะ, กระจกเงา', en: 'Minimalist decor, art photography, mirror', ru: 'Минималистичный декор, художественные фотографии, зеркало', zh: '极简主义装饰、艺术摄影、镜子' } },
            { id: 'lighting', cost: 25000, checked: true, name: { th: 'ระบบไฟ', en: 'Lighting System', ru: 'Система освещения', zh: '照明系统' }, description: { th: 'โคมไฟหลัก, ไฟซ่อน, ไฟตกแต่ง, Smart Lighting (เริ่มต้น)', en: 'Main lamps, concealed lighting, decorative lights, Smart Lighting (starter)', ru: 'Основные светильники, скрытое освещение, декоративные светильники, умное освещение (стартовый комплект)', zh: '主灯、隐藏式照明、装饰灯、智能照明（入门级）' } },
            { id: 'curtains', cost: 12000, checked: true, name: { th: 'ผ้าม่าน', en: 'Curtains', ru: 'Шторы', zh: '窗帘' }, description: { th: 'ผ้าม่านโปร่งและทึบ หรือม่านปรับแสง', en: 'Sheer and blackout curtains or blinds', ru: 'Прозрачные и плотные шторы или жалюзи', zh: '纱帘和遮光帘或百叶窗' } },
            { id: 'labor', cost: 28000, checked: true, name: { th: 'ค่าแรงและติดตั้ง', en: 'Labor & Installation', ru: 'Работы и монтаж', zh: '人工与安装' }, description: { th: 'ค่าแรงช่างสำหรับติดตั้งเฟอร์นิเจอร์, ทาสี, และงานระบบ', en: 'Labor for furniture assembly, painting, and system installation', ru: 'Оплата работ по сборке мебели, покраске и установке систем', zh: '家具组装、粉刷和系统安装的人工费' } },
            { id: 'misc', cost: 10000, checked: true, name: { th: 'ค่าใช้จ่ายอื่นๆ', en: 'Miscellaneous', ru: 'Прочие расходы', zh: '其他费用' }, description: { th: 'ค่าขนส่ง, ค่าดำเนินการ และสำรองค่าใช้จ่าย', en: 'Transportation, processing fees, and contingency', ru: 'Транспорт, административные сборы и непредвиденные расходы', zh: '运输、手续费和应急费用' } }
        ];

        // --- DOM ELEMENTS ---
        const itemsContainer = document.getElementById('quotation-items');
        const totalCostEl = document.getElementById('total-cost');
        const aiModal = document.getElementById('ai-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const loadingOverlay = document.getElementById('loading-overlay');
        let currentLang = 'th';

        // --- CORE FUNCTIONS ---
        function renderItems() {
            itemsContainer.innerHTML = '';
            quotationData.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = `quotation-card p-4 border-2 rounded-lg bg-white ${item.checked ? 'checked' : ''}`;
                
                let aiButton = '';
                if (item.id.includes('furniture')) {
                    aiButton = `<button class="mt-2 text-xs bg-green-100 text-green-800 font-semibold py-1 px-3 rounded-lg hover:bg-green-200 transition" onclick="event.stopPropagation(); visualizeWithAi('${item.id}')" data-lang="visualize_ai_btn">${translations[currentLang].visualize_ai_btn}</button>`;
                }

                itemCard.innerHTML = `
                    <div class="flex items-start cursor-pointer" onclick="toggleCheckbox(event, '${item.id}')">
                        <input type="checkbox" id="${item.id}" class="mt-1 h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 pointer-events-none" ${item.checked ? 'checked' : ''}>
                        <div class="ml-4 flex-1">
                            <label for="${item.id}" class="font-bold text-gray-900">${item.name[currentLang]}</label>
                            <p class="text-sm text-gray-600">${item.description[currentLang]}</p>
                            <div class="flex justify-between items-center mt-2">
                                ${aiButton}
                                <p class="font-semibold text-blue-700">${item.cost.toLocaleString()} THB</p>
                            </div>
                        </div>
                    </div>
                `;
                itemsContainer.appendChild(itemCard);
            });
        }
        
        function toggleCheckbox(event, itemId) {
            const checkbox = document.getElementById(itemId);
            checkbox.checked = !checkbox.checked;
            const itemData = quotationData.find(d => d.id === itemId);
            itemData.checked = checkbox.checked;
            event.currentTarget.parentElement.classList.toggle('checked', checkbox.checked);
            updateTotal();
        }

        function updateTotal() {
            let total = quotationData.reduce((sum, item) => item.checked ? sum + item.cost : sum, 0);
            totalCostEl.textContent = `${total.toLocaleString()} THB`;
        }
        
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        function changeLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if (translations[lang][key]) {
                    el.innerText = translations[lang][key];
                }
            });
            renderItems();
            document.querySelectorAll('.lang-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-lang-btn="${lang}"]`).classList.add('active');
        }

        // --- GEMINI API & MODAL FUNCTIONS ---
        const apiKey = "AIzaSyDj_fOvwZ80qfWaryvy5FNjSiyKt1wAF04"; // API key will be injected by the environment

        async function callGeminiAPI(prompt) {
            loadingOverlay.classList.add('visible');
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const result = await response.json();
                loadingOverlay.classList.remove('visible');
                return result.candidates[0].content.parts[0].text;

            } catch (error) {
                console.error("Gemini API call failed:", error);
                loadingOverlay.classList.remove('visible');
                return translations[currentLang].error_text;
            }
        }

        function openAiModal() {
            aiModal.classList.add('visible');
        }

        function closeAiModal() {
            aiModal.classList.remove('visible');
        }

        function openAiAssistant(conceptId) {
            const conceptTitle = document.querySelector(`#${conceptId} h4`).innerText;
            const conceptDesc = document.querySelector(`#${conceptId} [data-lang='concept${conceptId.slice(-1)}_desc']`).innerText;
            
            modalTitle.innerText = translations[currentLang].ai_assistant_title;
            modalBody.innerHTML = `
                <p class="mb-2 font-semibold">${conceptTitle}</p>
                <p class="mb-4 text-sm text-gray-600">${translations[currentLang].ai_assistant_prompt}</p>
                <textarea id="ai-query" class="w-full p-2 border rounded-md h-24" placeholder="..."></textarea>
                <button id="submit-ai-query" class="mt-4 w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition">${translations[currentLang].submit_query_btn}</button>
                <div id="ai-response" class="mt-4 p-4 bg-gray-100 rounded-md" style="display:none;"></div>
            `;
            openAiModal();

            document.getElementById('submit-ai-query').addEventListener('click', async () => {
                const userQuery = document.getElementById('ai-query').value;
                if (!userQuery) return;

                const prompt = `You are an AI interior design assistant for WIDEROOMS. The client, an INTP, is looking at the '${conceptTitle}' concept which is described as: '${conceptDesc}'. The client's request is: '${userQuery}'. Please provide a helpful and creative response in ${currentLang}, suggesting modifications or explaining design choices.`;
                
                const responseDiv = document.getElementById('ai-response');
                responseDiv.style.display = 'block';
                responseDiv.innerText = translations[currentLang].loading_text;

                const result = await callGeminiAPI(prompt);
                responseDiv.innerText = result;
            });
        }

        async function visualizeWithAi(itemId) {
            const item = quotationData.find(d => d.id === itemId);
            const itemName = item.name[currentLang];
            const itemDesc = item.description[currentLang];
            
            modalTitle.innerText = translations[currentLang].ai_visualize_title;
            modalBody.innerHTML = `<p class="mb-2 font-semibold">${itemName}</p><div id="ai-response" class="p-4 bg-gray-100 rounded-md">${translations[currentLang].loading_text}</div>`;
            openAiModal();

            const prompt = `As an expert interior designer, write a short, inspiring paragraph (in ${currentLang}) describing a room for an INTP personality. The design style is a mix of Minimalist, Coastal, and Futuristic. The room includes these key elements: '${itemName}' which consists of '${itemDesc}'. The overall vibe should be calm, cozy, and clean. Focus on how these elements create a functional, intellectually stimulating, and relaxing space.`;
            
            const result = await callGeminiAPI(prompt);
            document.querySelector('#ai-modal #ai-response').innerHTML = result.replace(/\n/g, '<br>');
        }

        // --- INITIAL SETUP ---
        document.addEventListener('DOMContentLoaded', () => {
            changeLanguage('th');
            updateTotal();
        });
    </script>
</body>
</html>

